--If user ISSUPER value = 1 else 0
CREATE TABLE CUSTOMER (
    USER_ID INTEGER NOT NULL,
    USER_NAME VARCHAR2(20),
    USER_PASS VARCHAR2(20),
    BANK_ACCOUNT_ID INTEGER NOT NULL,
    ISSUPER INTEGER DEFAULT 0 NOT NULL,
    ISLOGIN INTEGER DEFAULT 0 NOT NULL,
    CONSTRAINT PK_CUSTOMER PRIMARY KEY (USER_ID)
);

CREATE TABLE BANKACCOUNT (
    BANK_ACCOUNT_ID INTEGER NOT NULL,
    USER_ID INTEGER NOT NULL,
    BALANCE NUMBER DEFAULT 0 NOT NULL,
    CONSTRAINT PK_BANKACCOUNT PRIMARY KEY (BANK_ACCOUNT_ID)
);

ALTER TABLE CUSTOMER
ADD CONSTRAINT FK_CUSTOMER_BANKACCOUNT
FOREIGN KEY (BANK_ACCOUNT_ID) REFERENCES BANKACCOUNT(BANK_ACCOUNT_ID);

CREATE SEQUENCE CUST_USERID_SEQ
    MINVALUE 1
    MAXVALUE 999
    START WITH 1
    INCREMENT BY 1
    NOCACHE;

CREATE SEQUENCE CUST_ACCOUNT_SEQ
    MINVALUE 11
    MAXVALUE 999
    START WITH 11
    INCREMENT BY 1
    NOCACHE;
    
CREATE SEQUENCE ACCT_USERID_SEQ
    MINVALUE 1
    MAXVALUE 999
    START WITH 1
    INCREMENT BY 1
    NOCACHE;

CREATE SEQUENCE ACCT_ACCOUNT_SEQ
    MINVALUE 11
    MAXVALUE 999
    START WITH 11
    INCREMENT BY 1
    NOCACHE;
    
-- INCREMENT BANKACCOUNT -> BANK_ACCOUNT_ID
CREATE OR REPLACE TRIGGER ACCTTABLE_ACCOUNTID
BEFORE INSERT ON BANKACCOUNT
FOR EACH ROW
BEGIN
    SELECT ACCT_ACCOUNT_SEQ.NEXTVAL
    INTO :NEW.BANK_ACCOUNT_ID FROM DUAL;
END;
/
-- INCREMENT BANKACCOUNT -> USER_ID
CREATE OR REPLACE TRIGGER ACCTTABLE_USERID
BEFORE INSERT ON BANKACCOUNT
FOR EACH ROW
BEGIN
    SELECT ACCT_USERID_SEQ.NEXTVAL
    INTO :NEW.USER_ID FROM DUAL;
END;
/

-- INCREMENT CUSTOMER -> USER_ID
CREATE OR REPLACE TRIGGER USERTABLE_USERID
BEFORE INSERT ON CUSTOMER
FOR EACH ROW
BEGIN
    SELECT CUST_USERID_SEQ.NEXTVAL
    INTO :NEW.USER_ID FROM DUAL;
END;
/

-- INCREMENT CUSTOMER -> BANK_ACCOUNT_ID
CREATE OR REPLACE TRIGGER USERTABLE_ACCOUNTID
BEFORE INSERT ON CUSTOMER
FOR EACH ROW
BEGIN
    SELECT CUST_ACCOUNT_SEQ.NEXTVAL
    INTO :NEW.BANK_ACCOUNT_ID FROM DUAL;
END;
/

INSERT INTO BANKACCOUNT (BALANCE) VALUES (500);
INSERT INTO BANKACCOUNT (BALANCE) VALUES (300);


INSERT INTO CUSTOMER  (USER_NAME, USER_PASS, ISSUPER) VALUES ('John', 'password1', 1);
INSERT INTO CUSTOMER  (USER_NAME, USER_PASS) VALUES ('Hello', 'password2');

COMMIT;

SELECT * FROM BANKACCOUNT;
SELECT * FROM CUSTOMER;
--DROP SEQUENCE CUST_USERID_SEQ;
--DROP SEQUENCE CUST_ACCOUNT_SEQ;
--DROP SEQUENCE ACCT_USERID_SEQ;
--DROP SEQUENCE ACCT_ACCOUNT_SEQ;
--DROP TRIGGER ACCTTABLE_ACCOUNTID;
--DROP TRIGGER ACCTTABLE_USERID;
--DROP TRIGGER USERTABLE_USERID;
--DROP TRIGGER USERTABLE_ACCOUNTID;
--DROP TABLE CUSTOMER;
--DROP TABLE BANKACCOUNT;
