CREATE TABLE EMPLOYEE
(
    EMPLOYEE_ID NUMBER NOT NULL,
    EMP_FIRSTNAME VARCHAR2(20) NOT NULL,
    EMP_LASTNAME VARCHAR2(20) NOT NULL,
    DEPARTMENT_ID NUMBER NOT NULL,
    SALARY NUMBER,
    EMP_EMAIL VARCHAR(30),
    CONSTRAINT PK_EMPLOYEE PRIMARY KEY (EMPLOYEE_ID)
);

CREATE TABLE DEPARTMENT
(
    DEPARTMENT_ID NUMBER NOT NULL,
    DEPARTMENT_NAME VARCHAR2(20) NOT NULL,
    CONSTRAINT PK_DEPARTMENT PRIMARY KEY (DEPARTMENT_ID)
);    

CREATE SEQUENCE EMPLOYEE_SEQUENCE
  START WITH 1
  INCREMENT BY 1;
  
CREATE SEQUENCE DEPARTMENT_SEQUENCE
  START WITH 1
  INCREMENT BY 1;
  
CREATE OR REPLACE TRIGGER EMPLOYEE_ON_INSERT
  BEFORE INSERT ON EMPLOYEE
  FOR EACH ROW
BEGIN
  SELECT EMPLOYEE_SEQUENCE.nextval
  INTO :new.EMPLOYEE_ID
  FROM dual;
END;
/

CREATE OR REPLACE TRIGGER DEPARTMENT_ON_INSERT
  BEFORE INSERT ON DEPARTMENT
  FOR EACH ROW
BEGIN
  SELECT DEPARTMENT_SEQUENCE.nextval
  INTO :new.DEPARTMENT_ID
  FROM dual;
END;
/

CREATE OR REPLACE PROCEDURE SP_GIVE_RAISE 
    (D_ID IN NUMBER,
    New_AVG OUT NUMBER)
    AS
    New_Salary NUMBER;
    BEGIN
        SELECT SALARY INTO New_SALARY FROM EMPLOYEE WHERE DEPARTMENT_ID = D_ID;
        New_Salary := New_Salary*1.10;
        UPDATE EMPLOYEE SET SALARY = New_Salary WHERE DEPARTMENT_ID = D_ID;
        SELECT AVG(SALARY) INTO New_AVG FROM EMPLOYEE WHERE DEPARTMENT_ID = D_ID;
    End;
/

